{% extends "base.html" %}

{% block title %}대시보드 - Shieldus Bank{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2><i class="bi bi-house-door"></i> 대시보드</h2>
        <p class="text-muted">환영합니다, {{ session.username }}님!</p>
    </div>
</div>

<!-- 계좌 목록 -->
<div class="row mb-4">
    <div class="col-12">
        <h4 class="mb-3"><i class="bi bi-wallet2"></i> 내 계좌</h4>
    </div>
</div>

<div class="row g-4 mb-5">
    {% if accounts %}
        {% for account in accounts %}
        <div class="col-md-6 col-lg-4">
            <div class="card card-custom h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h5 class="card-title mb-1">
                                {% if account.account_type == 'SAVINGS' %}
                                    <i class="bi bi-piggy-bank text-success"></i> 입출금통장
                                {% else %}
                                    <i class="bi bi-credit-card text-primary"></i> 자유입출금
                                {% endif %}
                            </h5>
                            <p class="text-muted small mb-0">{{ account.account_number }}</p>
                        </div>
                        <span class="badge bg-success">활성</span>
                    </div>
                    <div class="balance-display mb-3">
                        {{ "{:,.0f}".format(account.balance) }} 원
                    </div>
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('transactions', account_id=account.id) }}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-list-ul"></i> 거래내역
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="col-12">
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> 등록된 계좌가 없습니다.
                <a href="{{ url_for('create_account') }}" class="alert-link">새 계좌를 개설</a>하세요.
            </div>
        </div>
    {% endif %}

    <div class="col-md-6 col-lg-4">
        <div class="card card-custom h-100 bg-light">
            <div class="card-body text-center d-flex flex-column justify-content-center">
                <div class="mb-3" style="font-size: 3rem; color: var(--secondary-color);">
                    <i class="bi bi-plus-circle"></i>
                </div>
                <h6 class="mb-3">새 계좌 개설</h6>
                <a href="{{ url_for('create_account') }}" class="btn btn-gold">
                    계좌 개설하기
                </a>
            </div>
        </div>
    </div>
</div>

<!-- 빠른 서비스 -->
<div class="row mb-4">
    <div class="col-12">
        <h4 class="mb-3"><i class="bi bi-lightning"></i> 빠른 서비스</h4>
    </div>
</div>

<div class="row g-3 mb-5">
    <div class="col-md-3">
        <a href="{{ url_for('deposit') }}" class="text-decoration-none">
            <div class="card card-custom text-center">
                <div class="card-body">
                    <i class="bi bi-plus-circle" style="font-size: 2rem; color: var(--success-color);"></i>
                    <h6 class="mt-2 mb-0">입금</h6>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{{ url_for('withdraw') }}" class="text-decoration-none">
            <div class="card card-custom text-center">
                <div class="card-body">
                    <i class="bi bi-dash-circle" style="font-size: 2rem; color: var(--danger-color);"></i>
                    <h6 class="mt-2 mb-0">출금</h6>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{{ url_for('transfer') }}" class="text-decoration-none">
            <div class="card card-custom text-center">
                <div class="card-body">
                    <i class="bi bi-arrow-left-right" style="font-size: 2rem; color: var(--primary-color);"></i>
                    <h6 class="mt-2 mb-0">송금</h6>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{{ url_for('transactions') }}" class="text-decoration-none">
            <div class="card card-custom text-center">
                <div class="card-body">
                    <i class="bi bi-list-ul" style="font-size: 2rem; color: var(--secondary-color);"></i>
                    <h6 class="mt-2 mb-0">거래내역</h6>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- 최근 거래내역 -->
<div class="row mb-4">
    <div class="col-12">
        <h4 class="mb-3"><i class="bi bi-clock-history"></i> 최근 거래내역</h4>
    </div>
</div>

<div class="row">
    <div class="col-12">
        {% if recent_transactions %}
        <div class="card card-custom">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>계좌</th>
                                <th>구분</th>
                                <th>내용</th>
                                <th class="text-end">금액</th>
                                <th class="text-end">잔액</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for trans in recent_transactions %}
                            <tr>
                                <td>{{ trans.created_at[:16] }}</td>
                                <td><small class="text-muted">{{ trans.account_number }}</small></td>
                                <td>
                                    {% if trans.transaction_type == 'DEPOSIT' %}
                                        <span class="badge bg-success">입금</span>
                                    {% elif trans.transaction_type == 'WITHDRAW' %}
                                        <span class="badge bg-danger">출금</span>
                                    {% else %}
                                        <span class="badge bg-primary">송금</span>
                                    {% endif %}
                                </td>
                                <td>{{ trans.description }}</td>
                                <td class="text-end {% if trans.amount > 0 %}transaction-positive{% else %}transaction-negative{% endif %}">
                                    {{ "{:+,.0f}".format(trans.amount) }}원
                                </td>
                                <td class="text-end">{{ "{:,.0f}".format(trans.balance_after) }}원</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('transactions') }}" class="btn btn-outline-primary">
                        전체 거래내역 보기 <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> 최근 거래내역이 없습니다.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
